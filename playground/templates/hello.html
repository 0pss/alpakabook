{% load static %} <!-- Add this line at the top of the template -->
{% load bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
{% load bootstrap_icons %}



<!-- TODO:-->
<!-- Freundschaftsstatus, Freundschaftsanfragen -->
<!-- Alles aus Datenbank auslesen -->
<!-- Datenbank generieren -->
<!-- Sessioncookie& userverwaltung -->


<!DOCTYPE html>
<html>
<head>
    <title>Alpakabook</title>

    <style>
        /* CSS for the blue banner */
        @font-face {
            font-family: 'alpaka';
            src: url("{% static 'klavika-medium.otf' %}") format('opentype'); /* Update the font file path */
            font-weight: normal;
            font-style: normal;
        }
        
        .banner {
            background-color: #4267B2; /* Blue color similar to Facebook */
            padding:  10px 10px 0px 20px;
            color: white;
            font-family: 'alpaka'; /* Use the custom font followed by fallback fonts */
            /*font-weight: bold;*/
            max-width: 100%; /* Make the banner span the whole page width */
            position: relative;
        }
        
        /* CSS for the main content */
        .content {
            margin: 20px;
        }

        img.fixed {
            border: 5px outset lightgray;
            border-radius: 2%;
            width:100%;
            position: relative;
            top:20px;
        }

        img.round {
            border-radius: 50%;
            margin:1px;
            float:right;
        }

        p.lol {
        float: right;
        padding: 15px 0px 0px 0px; 
        }

        h2.lol {
            float: left;
            margin: 9px 0px 25px 9px;
        }

        h2.lol2 {
            float: left;
            margin: 9px 0px 25px -10px;
        }

        /* CSS for the profile picture */
        .profile-picture {
            width: 30px; /* Adjust the size as needed */
            height: 30px; /* Adjust the size as needed */
            border-radius: 50%;
            top:5px;
            
        }

        /* CSS for the username */
        .username {
            font-size: 14px;

        }

        /* CSS for the footer */
        .footer {
            background-color: #f2f2f2; /* Light gray background */
            padding: 10px;
            text-align: center;
            font-family: 'Arial', sans-serif;
            font-size: 12px;
            margin-bottom: 0px;
        }

        /* Reset body margin and padding to remove white space */
        body {
            margin: 0;
            padding: 0;
        }

        .nav-link{
  color: white !important;
  }


        .custom-margin {
    margin-left: 15px; /* Adjust the margin-right value as needed */
}

        /* Add this CSS to your project's stylesheets */
.table-label {
    width: 30%; /* Adjust the width as needed */
    font-weight: bold; /* Optionally make the label text bold */
}
    </style>
</head>
<body>
    <div class="banner">

        <div class="container-fluid" style="position: relative; left:-10px;">
            <div class="row">
              <div class="col-4">
          <h1 style="font-family: 'alpaka', Arial, sans-serif;">alpakabook</h1>
          </div>
          <div class="col-5">

        <form method="get" action="{% url 'search_results' %}">
            <div class="input-group">
                    <input type="search" name="search_query" class="form-control rounded" placeholder="Suche" aria-label="Search" aria-describedby="search-addon" />
                    <button type="submit" class="btn btn-outline-light">{% bs_icon 'search' %}</button>
            </div>
        </form>

          </div>
          <div class="col-3">
    <a style="float: right;" class="nav-link" href="{% url 'notifications' %}">
        {{ user }} ðŸ“¬ <!-- Add the emoji character for notifications -->
    </a>
    <a href="#">
        <img src="{% static 'U1.jpg' %}" alt="" width="40" height="40" class="round">
    </a>
</div></div>

            </div>











           <!-- <h1 style="font-family: 'alpaka', Arial, sans-serif;">alpakabook</h1>-->
    </div>
    <div class="content">
    <div class="container-fluid" style="position: relative; left:-10px;">
        <div class="row">
          <div class="col-3">
            <!-- User profile picture -->
        <img src="{% static 'U1.jpg' %}" alt="Profile Picture" class="fixed default-profile-picture">
          </div>
          <div class="col-6"><h2 style="font-family:  Arial, sans-serif; color:#142b58" class="lol">{{user}}         </h2>


           <div id="friendship-status" class="custom-margin">
                {% if request.user != user %}
                   <button id="friendship-button"
                            data-user-id="{{ user.id }}"
                            data-status="{{ user.friendship_status }}"
                            class="ml-2
                                   {% if user.friendship_status == 'send_request' %}btn btn-primary{% elif user.friendship_status == 'request_sent' %}btn btn-secondary{% elif user.friendship_status == 'friends' %}btn btn-success{% endif %}
                                   mt-2 custom-margin"
                            {% if user.friendship_status != 'send_request' %}disabled{% endif %}>
                        {{ user.friendship_status_display }}
                    </button>


                {% endif %}
            </div>



{% if is_friends %}
        <table class="table">
           
            <tr>
              <td class="table-label">E-mail</td>
              <td>{{user.Email}}</td>
            </tr>
            <tr>
              <td class="table-label">Name</td>
              <td>{{user.Name}}</td>
            </tr>
            
            <tr>
              <td class="table-label">Alter</td>
              <td>{{user.Age}}</td>
            </tr>
            <tr>
              <td class="table-label">Lieblingseis</td>
              <td>{{user.FavIce}}</td>
            </tr>
            <tr>
              <td class="table-label">HufgrÃ¶ÃŸe</td>
              <td>{{user.Shoesize}}</td>
            </tr>
            <tr>
              <td class="table-label">Hobbies</td>
              <td>{{user.Hobbies}}</td>
            </tr>
          </table>
    {% else %}
<br><br>
        You must become friends with this user to see their activities and personal information.
        <!-- Add a button to send a friend request or take other actions -->
    {% endif %}
        </div>
        <div class="col-3">
            <div class="container">
            <div class="row">
            <h2 style="font-family:  Arial, sans-serif; color:#142b58" class="lol2">Freund*innen:</h2>
            </div>
            
                <div class="row">
                  <div class="col">
                    <img src="{% static 'default.png' %}" class="img-thumbnail" alt="...">
                  </div>
                  <div class="col">
                    <img src="{% static 'default.png' %}" class="img-thumbnail" alt="...">
                  </div>
                  <div class="col">
                    <img src="{% static 'default.png' %}" class="img-thumbnail" alt="...">
                  </div>
                </div>
                <br>
                <div class="row">
                    <div class="col-4">
                      <img src="{% static 'default.png' %}" class="img-thumbnail" alt="...">
                    </div>
                    <div class="col-4">
                      <img src="{% static 'default.png' %}" class="img-thumbnail" alt="...">
                    </div>
                    <div class="col-4">
                      <img src="{% static 'default.png' %}" class="img-thumbnail" alt="...">
                    </div>
                  </div>
                  <br>
                  <div class="row">
                    <div class="col">
                      <img src="{% static 'default.png' %}" class="img-thumbnail" alt="...">
                    </div>
                    <div class="col">
                      <img src="{% static 'default.png' %}" class="img-thumbnail" alt="...">
                    </div>
                    <div class="col">
                      <img src="{% static 'default.png' %}" class="img-thumbnail" style="width: 100%;">
                    </div>
                  </div>






              </div>





        </div>
        </div>
      </div>
    
   

          
          <br>

                    <div id="post-section">
                <h3>Posts:</h3>
            {% if is_friends %}
                <div class="list-group">
                    <!-- Posts will be displayed here -->
                </div>
            </div>

            <div id="post-form">
                {% if request.user.id == user.id %}
                    <h3>Create a Post:</h3>
                    <form method="post" id="create-post-form">
                        {% csrf_token %}
                        <textarea name="content" id="post-content" placeholder="Write your post here"></textarea>
                        <button type="submit">Post</button>
                    </form>
                {% endif %}
            </div>
     {% else %}

        <p>You must become friends with this user to see their activities and personal information.</p>
        <!-- Add a button to send a friend request or take other actions -->
    {% endif %}




               <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
                // Function to retrieve and display posts
                   function getPosts(userId) {
                        $.get(`/user/${userId}/get_posts/`, function (data) {
                            $('#post-section .list-group').html(data);
                        });
                    }

                // Event handler for post submission
                $('#create-post-form').submit(function (event) {
                    event.preventDefault();
                    $.ajax({
                        url: `/user/{{ user.id }}/create_post/`,
                        method: 'POST',
                        data: $(this).serialize(),
                        success: function () {
                            // Clear the textarea after successful submission
                            $('#post-content').val('');
                            // Retrieve and display the updated list of posts
                            getPosts({{user.id}});
                        },
                    });
                });

                // Initial load of posts
                getPosts({{user.id}});





            // FRIENDSHIP STUFF


                // Add an event listener for the button click
                document.addEventListener('DOMContentLoaded', function() {
                    const friendshipButton = document.getElementById('friendship-button');
                    if (friendshipButton) {
                        friendshipButton.addEventListener('click', function() {
                            const userId = friendshipButton.getAttribute('data-user-id');
                            const currentStatus = friendshipButton.getAttribute('data-status');

                            // Use AJAX to send the friend request or accept the request based on the currentStatus
                            // Here's a simplified example using Fetch API:
                            fetch(`/user/handle_friend_request/${userId}/`, {
                                method: 'POST',
                                body: JSON.stringify({ status: currentStatus }),
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': getCookie('csrftoken'), // Ensure you have a function to get CSRF token
                                },
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    // Update the button text and data-status attribute
                                    friendshipButton.textContent = data.new_status_display;
                                    friendshipButton.setAttribute('data-status', data.new_status);
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                        });
                    }
                });

                // Function to get CSRF token
                function getCookie(name) {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            // Does this cookie string begin with the name we want?
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                }


            // END FRIENDSHIP STUFF


            </script>



</div>
    
    <div class="footer">
        <p>&copy; 2023 Alpakabook. All rights reserved.</p>
    </div>
</body>
</html>
